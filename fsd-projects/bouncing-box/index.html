<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Bouncing Box</title>
    <script src="jquery.min.js"></script>
    <style>
      .box {
        width: 70px;
        height: 70px;
        background-color: teal;
        font-size: 300%;
        text-align: center;
        user-select: none;
        display: block;
        position: absolute;
        top: 100px; /* Initial vertical position */
        left: 0px;
      }

      .board {
        height: 100vh;
        /* Using a default pattern background for better compatibility, 
           as the URL for your original image may not be public. */
        background-color: #333; 
         background-image: url("https://www.bing.com/th/id/OIP.1gm9ZgMMKWXwKNYw0GP36gHaEK?w=245&h=211&c=8&rs=1&qlt=90&o=6&cb=12&dpr=1.3&pid=3.1&rm=2");
        background-position: center;
        background-size: cover;
      }

      .Game-over {
        font-size: 40px;
        color: red; /* Changed to red so it's visible */
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: none;
        z-index: 10;
        text-shadow: 2px 2px 4px black;
      }

      .misclick-counter {
        position: absolute;
        top: 10px;
        left: 10px;
        font-size: 24px;
        color: white;
        text-shadow: 1px 1px 2px black;
      }
    </style>
  </head>

  <body class="board">

    <div class="box">?</div>
    <div class="misclick-counter">misses: 0</div>
    <div class="Game-over">Divine's Bouncing Box - GAME OVER</div>

    <script>
      (function () {
        "use strict";

        var gameOverMessage = jQuery(".Game-over");
        var missCounterDisplay = jQuery(".misclick-counter");
        
        var box = jQuery(".box");
        var board = jQuery(".board");

        var boardWidth = board.width();
        var boardHeight = jQuery(window).height();

        jQuery(window).on("resize", function () {
          boardWidth = board.width();
          boardHeight = jQuery(window).height(); // Ensure height updates on resize
        });

        // GAME VARIABLES
        var positionX = 0;
        var positionY = 100; // Match CSS initial 'top' value
        var speed = 10;
        var speedY = 5; // Reduced initial speedY for smoother play
        var points = 0;
        var misses = 0;
        var maxMisses = 5;
        var gameActive = true;

        var interval = setInterval(update, 50);

        // BOARD CLICK = MISCLICK (increase miss count)
        board.on("click", function () {
          if (!gameActive) return;
          misses++;
          missCounterDisplay.text("misses: " + misses);

          if (misses >= maxMisses) {
            endGame();
          }
        });

        // BOX CLICK â€” do NOT count as miss
        box.on("click", function (event) {
          event.stopPropagation();
          handleBoxClick(event);
        });

        function moveBoxTo(newPositionX, newPositionY) {
          box.css("left", newPositionX);
          box.css("top", newPositionY);
        }

        function changeBoxText(newText) {
          box.text(newText);
        }

        // REAL GAME OVER FUNCTION
        function endGame() {
          gameActive = false;
          clearInterval(interval);
          box.hide();
          gameOverMessage.show();
        }

        function update() {
          if (!gameActive) return;

          // TODO 2 & 5: Update position
          positionX += speed;
          positionY += speedY;

          moveBoxTo(positionX, positionY);

          // TODO 6 & 7: Horizontal Bounce Check
          if (positionX < 0 || positionX > boardWidth - box.width()) {
            speed = -speed;
          }

          // Custom Vertical Bounce Check
          if (positionY < 0 || positionY > boardHeight - box.height()) {
            speedY = -speedY;
          }
        }

        function handleBoxClick() {
          if (!gameActive) return;

          // TODO 4: Increment points
          points++;
          
          // TODO 8 FIX: Use linear formula to calculate speed magnitude (10 + 3 * points)
          // Then, reassign speed while preserving its current direction (sign).
          var newMagnitude = 10 + (3 * points); 
          speed = (speed > 0) ? newMagnitude : -newMagnitude; 
          
          // TODO 3: Reset positions
          positionX = 0;
          positionY = 100; // Reset Y to initial value

          // TODO 3 & 4: Change text
          changeBoxText(points);

          // Custom: Change color every 3 clicks
          if (points % 3 === 0) {
            box.css("background-color", getRandomColor());
          }
        }

        function getRandomColor() {
          var r = Math.floor(Math.random() * 255);
          var g = Math.floor(Math.random() * 255);
          var b = Math.floor(Math.random() * 255);
          return "rgb(" + r + "," + g + "," + b + ")";
        }
      })();
    </script>
  </body>
</html>